<svg width="900" height="550" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="memGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#1d4ed8;stop-opacity:1" />
    </linearGradient>
    <filter id="memShadow" x="-10%" y="-10%" width="120%" height="120%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
  </defs>

  <!-- Background -->
  <rect width="900" height="550" fill="#0f172a"/>

  <!-- Title -->
  <text x="450" y="45" text-anchor="middle" font-family="Inter, system-ui, sans-serif" font-size="28" font-weight="700" fill="#f8fafc">
    Token Memory Layout
  </text>
  <text x="450" y="75" text-anchor="middle" font-family="Inter, sans-serif" font-size="16" fill="#94a3b8">
    ADR-004: Exactly 12 bytes per token
  </text>

  <!-- Memory diagram -->
  <g transform="translate(100, 120)">
    <!-- Byte ruler -->
    <text x="0" y="0" font-family="JetBrains Mono, monospace" font-size="12" fill="#64748b">Byte offset:</text>
    <g transform="translate(0, 15)">
      <rect x="0" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="30" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">0</text>
      <rect x="60" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="90" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">1</text>
      <rect x="120" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="150" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">2</text>
      <rect x="180" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="210" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">3</text>
      <rect x="240" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="270" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">4</text>
      <rect x="300" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="330" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">5</text>
      <rect x="360" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="390" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">6</text>
      <rect x="420" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="450" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">7</text>
      <rect x="480" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="510" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">8</text>
      <rect x="540" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="570" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">9</text>
      <rect x="600" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="630" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">10</text>
      <rect x="660" width="60" height="25" fill="#1e293b" stroke="#334155"/>
      <text x="690" y="17" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#94a3b8">11</text>
    </g>

    <!-- Token struct -->
    <g transform="translate(0, 60)" filter="url(#memShadow)">
      <!-- TokenKind (1 byte) -->
      <rect x="0" width="60" height="60" rx="6" fill="#8b5cf6"/>
      <text x="30" y="35" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700" fill="white">kind</text>
      <text x="30" y="50" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="9" fill="rgba(255,255,255,0.7)">u8</text>

      <!-- Padding (3 bytes) -->
      <rect x="60" width="180" height="60" rx="6" fill="#475569"/>
      <text x="150" y="35" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700" fill="#94a3b8">padding</text>
      <text x="150" y="50" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="9" fill="#64748b">alignment</text>

      <!-- Span.start (4 bytes) -->
      <rect x="240" width="240" height="60" rx="6" fill="#10b981"/>
      <text x="360" y="35" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700" fill="white">span.start</text>
      <text x="360" y="50" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="9" fill="rgba(255,255,255,0.7)">u32</text>

      <!-- Span.end (4 bytes) -->
      <rect x="480" width="240" height="60" rx="6" fill="#3b82f6"/>
      <text x="600" y="35" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" font-weight="700" fill="white">span.end</text>
      <text x="600" y="50" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="9" fill="rgba(255,255,255,0.7)">u32</text>
    </g>

    <!-- Labels -->
    <g transform="translate(0, 140)">
      <text x="30" y="0" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" fill="#8b5cf6">1 byte</text>
      <text x="150" y="0" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" fill="#64748b">3 bytes</text>
      <text x="360" y="0" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" fill="#10b981">4 bytes</text>
      <text x="600" y="0" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" fill="#3b82f6">4 bytes</text>
    </g>
  </g>

  <!-- TokenKind enum visualization -->
  <g transform="translate(100, 300)">
    <text x="0" y="0" font-family="Inter, sans-serif" font-size="16" font-weight="600" fill="#f8fafc">TokenKind fits in 1 byte (u8 = 256 values):</text>

    <g transform="translate(0, 25)">
      <!-- Category boxes -->
      <rect width="140" height="80" rx="8" fill="#1e293b"/>
      <text x="70" y="25" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" font-weight="600" fill="#a78bfa">Keywords</text>
      <text x="70" y="45" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">fn, let, if,</text>
      <text x="70" y="60" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">else, while...</text>
      <text x="70" y="75" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#8b5cf6">30 variants</text>

      <rect x="160" width="140" height="80" rx="8" fill="#1e293b"/>
      <text x="230" y="25" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" font-weight="600" fill="#f472b6">Operators</text>
      <text x="230" y="45" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">+, -, *, /,</text>
      <text x="230" y="60" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">==, !=, &amp;&amp;...</text>
      <text x="230" y="75" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#ec4899">35 variants</text>

      <rect x="320" width="140" height="80" rx="8" fill="#1e293b"/>
      <text x="390" y="25" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" font-weight="600" fill="#22c55e">Literals</text>
      <text x="390" y="45" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">int, float,</text>
      <text x="390" y="60" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">string, char</text>
      <text x="390" y="75" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#10b981">5 variants</text>

      <rect x="480" width="140" height="80" rx="8" fill="#1e293b"/>
      <text x="550" y="25" text-anchor="middle" font-family="Inter, sans-serif" font-size="12" font-weight="600" fill="#fbbf24">Other</text>
      <text x="550" y="45" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">Ident, Eof,</text>
      <text x="550" y="60" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="10" fill="#94a3b8">Error, Comment</text>
      <text x="550" y="75" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="11" fill="#f59e0b">~10 variants</text>
    </g>

    <text x="350" y="130" text-anchor="middle" font-family="JetBrains Mono, monospace" font-size="14" fill="#64748b">
      Total: ~80 variants (fits in u8 with room to spare)
    </text>
  </g>

  <!-- Why not store values -->
  <g transform="translate(100, 460)">
    <text x="0" y="0" font-family="Inter, sans-serif" font-size="14" font-weight="600" fill="#f8fafc">
      Why no literal values in Token?
    </text>
    <text x="0" y="25" font-family="Inter, sans-serif" font-size="13" fill="#94a3b8">
      90% of tokens (keywords, operators, punctuation) have no value.
    </text>
    <text x="0" y="45" font-family="Inter, sans-serif" font-size="13" fill="#94a3b8">
      Storing
    </text>
    <text x="55" y="45" font-family="JetBrains Mono, monospace" font-size="13" fill="#f472b6">Option&lt;Value&gt;</text>
    <text x="175" y="45" font-family="Inter, sans-serif" font-size="13" fill="#94a3b8">would bloat every token by 16+ bytes.</text>
    <text x="0" y="65" font-family="Inter, sans-serif" font-size="13" fill="#10b981">
      Solution: Extract values from source when needed using Span.
    </text>
  </g>
</svg>
